<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Corvus PDF Factory — iPhone Safe</title>
  <style>
    :root{--bg:#0b1020;--card:#111a33;--txt:#eaf0ff;--mut:#9fb0d6;--acc:#7c5cff;--bd:rgba(255,255,255,.10)}
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:radial-gradient(1100px 700px at 20% 0%,#1b2c6b 0%,#0b1020 60%);color:var(--txt)}
    .wrap{max-width:980px;margin:0 auto;padding:22px}
    .card{background:rgba(17,26,51,.88);border:1px solid var(--bd);border-radius:18px;padding:14px;box-shadow:0 16px 36px rgba(0,0,0,.35)}
    .top{display:flex;gap:12px;align-items:flex-start;justify-content:space-between;flex-wrap:wrap}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg,var(--acc),#30d5ff);display:grid;place-items:center;color:#081023;font-weight:1000}
    h1{font-size:20px;margin:0}
    .sub{margin:6px 0 0;color:var(--mut);max-width:68ch;font-size:13px}
    label{display:block;color:var(--mut);font-size:12px;margin:10px 0 6px}
    input,select{width:100%;padding:11px 12px;border-radius:12px;border:1px solid var(--bd);background:rgba(0,0,0,.22);color:var(--txt);outline:none}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:820px){.row{grid-template-columns:1fr}}
    .checks{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px}
    @media (max-width:680px){.checks{grid-template-columns:1fr}}
    .check{display:flex;gap:10px;align-items:flex-start;padding:10px 12px;border-radius:14px;border:1px solid var(--bd);background:rgba(255,255,255,.05)}
    .check input{width:auto;margin-top:3px}
    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    button{cursor:pointer;border:none;border-radius:12px;padding:11px 14px;font-weight:900}
    .primary{background:linear-gradient(135deg,var(--acc),#30d5ff);color:#091027}
    .ghost{background:rgba(255,255,255,.07);color:var(--txt);border:1px solid var(--bd)}
    .mini{color:var(--mut);font-size:12px;margin-top:10px}
    .out{margin-top:10px;white-space:pre-wrap;line-height:1.35;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:12px;background:rgba(0,0,0,.25);border:1px solid var(--bd);border-radius:14px;padding:12px;min-height:72px}
    a{color:#2ee59d}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="top">
        <div class="brand">
          <div class="logo">C</div>
          <div>
            <h1>Corvus PDF Factory — iPhone Safe (Print-to-PDF)</h1>
            <div class="sub">This version avoids PDF download APIs that iOS blocks. It generates a printable document in a new tab. Then you use iPhone: Share → Print → pinch-out → Share → Save to Files (PDF).</div>
          </div>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Title</label>
          <input id="title" value="The Busy Week Bundle" />
        </div>
        <div>
          <label>Subtitle</label>
          <input id="subtitle" value="Food + focus + follow‑through" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>Theme</label>
          <select id="theme">
            <option value="minimal">Minimal</option>
            <option value="bold" selected>Bold</option>
            <option value="cute">Cute</option>
            <option value="luxury">Luxury</option>
          </select>
        </div>
        <div>
          <label>Format</label>
          <select id="fmt">
            <option value="a4" selected>A4</option>
            <option value="letter">US Letter</option>
          </select>
        </div>
      </div>

      <div class="checks">
        <div class="check"><input type="checkbox" id="cookbook" checked><div><b>Cookbook</b><div class="mini">Cover + 6–12 recipe pages (template)</div></div></div>
        <div class="check"><input type="checkbox" id="coloring" checked><div><b>Coloring book</b><div class="mini">Pattern pages (SVG outlines)</div></div></div>
        <div class="check"><input type="checkbox" id="planner"><div><b>Planner</b><div class="mini">Weekly + tracker + budget</div></div></div>
        <div class="check"><input type="checkbox" id="ebook"><div><b>Mini‑ebook</b><div class="mini">Short structured template</div></div></div>
      </div>

      <div class="btns">
        <button class="primary" id="gen">Generate printable PDF</button>
        <button class="ghost" id="help">How to save PDF on iPhone</button>
      </div>

      <div id="out" class="out">Ready.</div>
    </div>
  </div>

<script>
  const $ = (id)=>document.getElementById(id);
  const out = $('out');
  function log(s){ out.textContent = s; }

  function cssForTheme(t){
    if(t==='minimal') return {bg:'#ffffff', txt:'#0b1020', mut:'#4b5563', acc:'#111111'};
    if(t==='cute') return {bg:'#ffffff', txt:'#111827', mut:'#6b7280', acc:'#ff4da6'};
    if(t==='luxury') return {bg:'#fffdf8', txt:'#111111', mut:'#6b5b43', acc:'#b08d57'};
    return {bg:'#ffffff', txt:'#0b1020', mut:'#4b5563', acc:'#7c5cff'};
  }

  function coverHTML(meta){
    return `
<section class="page cover">
  <div class="badge">TEST EDITION</div>
  <h1>${escapeHTML(meta.title)}</h1>
  <p class="sub">${escapeHTML(meta.subtitle)}</p>
  <div class="meta">Generated by Corvus PDF Factory</div>
</section>`;
  }

  function tocHTML(items){
    const lis = items.map((x,i)=>`<div class="toc-row"><span>${i+1}. ${escapeHTML(x)}</span><span class="dots"></span><span>${i+2}</span></div>`).join('');
    return `
<section class="page">
  <h2>Table of Contents</h2>
  ${lis}
</section>`;
  }

  function recipePage(i){
    const titles=[
      '15‑Minute Lemon Garlic Chicken','One‑Pan Chickpea Bowl','Overnight Oats 3 Ways','Budget Pasta Primavera','Sheet‑Pan Salmon & Greens'
    ];
    const t=titles[i%titles.length];
    return `
<section class="page">
  <div class="hdr">Recipe ${i+1}</div>
  <h2>${escapeHTML(t)}</h2>
  <h3>Ingredients</h3>
  <ul>
    <li>Ingredient 1</li><li>Ingredient 2</li><li>Ingredient 3</li>
  </ul>
  <h3>Method</h3>
  <ol>
    <li>Prep ingredients.</li>
    <li>Cook in one pan.</li>
    <li>Taste + adjust salt/acid.</li>
  </ol>
  <div class="img">IMAGE AREA (v2 can generate)</div>
</section>`;
  }

  function coloringPage(i){
    // simple mandala-ish SVG
    const svg = `
<svg viewBox="0 0 600 800" xmlns="http://www.w3.org/2000/svg">
  <rect x="30" y="30" width="540" height="740" rx="24" ry="24" fill="none" stroke="#111" stroke-width="3"/>
  <g transform="translate(300 420)" fill="none" stroke="#111" stroke-width="2">
    ${Array.from({length:10}).map((_,k)=>`<circle r="${50+k*25}" />`).join('')}
    ${Array.from({length:20}).map((_,k)=>{
      const a = k*(Math.PI*2/20);
      const x1 = Math.cos(a)*80, y1=Math.sin(a)*80;
      const x2 = Math.cos(a)*260, y2=Math.sin(a)*260;
      return `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" />`;
    }).join('')}
  </g>
</svg>`;

    return `
<section class="page">
  <div class="hdr">Coloring Page ${i+1}</div>
  <div class="svg-wrap">${svg}</div>
  <div class="foot">Print & color • Personal use</div>
</section>`;
  }

  function plannerPages(){
    return `
<section class="page">
  <div class="hdr">Weekly Planner</div>
  <h2>Weekly Planner</h2>
  <div class="box"></div>
  <div class="grid">
    ${['Mon','Tue','Wed','Thu','Fri','Sat','Sun'].map(d=>`<div class="cell"><b>${d}</b><div class="lines"></div></div>`).join('')}
  </div>
</section>
<section class="page">
  <div class="hdr">Habit Tracker</div>
  <h2>Habit Tracker</h2>
  <table class="tbl">
    <tr><th>Habit</th>${Array.from({length:7}).map((_,i)=>`<th>D${i+1}</th>`).join('')}</tr>
    ${Array.from({length:10}).map(()=>`<tr><td>—</td>${Array.from({length:7}).map(()=>'<td></td>').join('')}</tr>`).join('')}
  </table>
</section>
<section class="page">
  <div class="hdr">Budget</div>
  <h2>Simple Budget</h2>
  <h3>Income</h3><div class="box"></div>
  <h3>Expenses</h3><div class="box" style="height:340px"></div>
</section>`;
  }

  function ebookPages(){
    return `
<section class="page">
  <div class="hdr">Mini‑Ebook</div>
  <h2>Mini‑Ebook Template</h2>
  <p>Use this layout to test an ebook concept quickly.</p>
  ${Array.from({length:8}).map((_,i)=>`<h3>Section ${i+1}</h3><p>• Key idea<br/>• Example<br/>• Action step</p>`).join('')}
</section>`;
  }

  function escapeHTML(s){
    return String(s||'').replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c]));
  }

  function buildDoc(){
    const meta = {
      title: $('title').value.trim() || 'Untitled',
      subtitle: $('subtitle').value.trim() || '',
      theme: $('theme').value,
      fmt: $('fmt').value,
    };
    const colors = cssForTheme(meta.theme);
    const picked = {
      cookbook: $('cookbook').checked,
      coloring: $('coloring').checked,
      planner: $('planner').checked,
      ebook: $('ebook').checked,
    };

    const items=[];
    if(picked.cookbook) items.push('Cookbook');
    if(picked.coloring) items.push('Coloring Book');
    if(picked.planner) items.push('Planner');
    if(picked.ebook) items.push('Mini‑Ebook');

    let body = coverHTML(meta) + tocHTML(items);

    if(picked.cookbook){
      const n = meta.fmt==='a4' ? 10 : 8;
      for(let i=0;i<n;i++) body += recipePage(i);
    }
    if(picked.coloring){
      const n = meta.fmt==='a4' ? 20 : 16;
      for(let i=0;i<n;i++) body += coloringPage(i);
    }
    if(picked.planner) body += plannerPages();
    if(picked.ebook) body += ebookPages();

    const css = `
      @page { size: ${meta.fmt==='a4'?'A4':'letter'}; margin: 18mm; }
      body{ font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif; background:${colors.bg}; color:${colors.txt}; }
      .page{ page-break-after: always; padding:0; }
      .cover{ position:relative; min-height: 1000px; border: 2px solid #111; border-radius: 18px; padding: 48px; background: linear-gradient(135deg, ${colors.acc}22, #30d5ff18); }
      .badge{ display:inline-block; font-weight:800; font-size:12px; padding:10px 14px; border-radius:999px; background:${colors.acc}; color:white; }
      h1{ font-size:48px; line-height:1.05; margin: 22px 0 8px; }
      .sub{ color:${colors.mut}; font-size:16px; max-width: 60ch; }
      .meta{ position:absolute; bottom: 44px; left: 48px; color:${colors.mut}; font-size:12px; }
      .hdr{ font-size:12px; color:${colors.mut}; letter-spacing:.2px; margin-bottom: 8px; }
      h2{ font-size:26px; margin: 10px 0 10px; }
      h3{ font-size:14px; margin: 16px 0 6px; color:${colors.mut}; }
      ul,ol{ margin: 6px 0 0 22px; }
      .img{ margin-top: 16px; height: 260px; border: 2px dashed #999; border-radius: 14px; display:flex; align-items:center; justify-content:center; color:${colors.mut}; font-weight:700; }
      .toc-row{ display:flex; gap:12px; align-items:center; font-size:14px; margin: 10px 0; }
      .dots{ flex:1; border-bottom: 1px dotted #bbb; transform: translateY(2px); }
      .svg-wrap{ display:flex; justify-content:center; }
      .foot{ margin-top: 10px; text-align:center; color:${colors.mut}; font-size:12px; }
      .box{ height:160px; border: 2px solid #111; border-radius: 14px; }
      .grid{ display:grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px; }
      .cell{ border:2px solid #111; border-radius: 14px; padding: 10px; min-height: 140px; }
      .lines{ margin-top: 8px; height: 100px; background: repeating-linear-gradient(to bottom, transparent 0, transparent 12px, #ddd 12px, #ddd 13px); }
      table.tbl{ width:100%; border-collapse: collapse; font-size:12px; }
      .tbl th,.tbl td{ border:1px solid #111; padding:6px; }
      .tbl th{ background:${colors.acc}12; }
      /* print UI */
      .toolbar{ position: fixed; top: 10px; right: 10px; z-index: 9999; display:flex; gap: 10px; }
      .toolbar button{ border:none; border-radius: 12px; padding: 10px 14px; font-weight:900; background:${colors.acc}; color:white; }
      @media print { .toolbar{ display:none; } }
    `;

    const html = `<!doctype html><html><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
      <title>${escapeHTML(meta.title)}</title>
      <style>${css}</style>
    </head><body>
      <div class="toolbar"><button onclick="window.print()">Print / Save PDF</button></div>
      ${body}
    </body></html>`;

    return html;
  }

  $('gen').addEventListener('click', ()=>{
    const html = buildDoc();

    // iOS Safari can block window.open and programmatic downloads.
    // So we create a Blob URL and show a link the user can tap.
    const blob = new Blob([html], {type: 'text/html'});
    const url = URL.createObjectURL(blob);

    out.textContent = '✅ Ready. Tap: ';
    const a = document.createElement('a');
    a.href = url;
    a.target = '_blank';
    a.rel = 'noopener';
    a.textContent = 'Open printable document';
    out.appendChild(a);

    const note = document.createElement('div');
    note.style.marginTop = '10px';
    note.textContent = 'Then tap “Print / Save PDF” inside the document.';
    out.appendChild(note);

    setTimeout(()=>{ try{URL.revokeObjectURL(url);}catch(e){} }, 600000);
  });

  $('help').addEventListener('click', ()=>{
    log('iPhone steps:\n1) Generate printable PDF\n2) In new tab tap: Print / Save PDF\n3) Share icon → Print\n4) Pinch-out on the preview → it becomes a PDF\n5) Share → Save to Files');
  });
</script>
</body>
</html>
